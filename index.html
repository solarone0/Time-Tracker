<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏãúÍ∞Ñ Ìä∏ÎûòÏª§</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
</head>
<body>
    <div id="app-wrapper">
        <div id="app-container">
            <main>
                <div class="main-header">
                    <h2>Ïã§ÏãúÍ∞Ñ ÏßÑÌñâÎ•†</h2>
                    <p>Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏãúÍ∞ÑÏù¥ ÏßÄÎÇòÍ∞ÄÎäî Í≤ÉÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                </div>

                <div class="tabs">
                    <button class="tab-button active">Ï†ÑÏ≤¥</button>
                </div>

                <div class="list-container">
                    <div class="list-item" id="day-item">
                        <div class="item-summary" role="button" tabindex="0" aria-expanded="false" aria-controls="day-details">
                           <div class="item-name">
                                <span>‚òÄÔ∏è</span>
                                <p>Ïò§Îäò</p>
                            </div>
                            <div class="item-stats">
                                <div class="item-value" id="day-percentage">0.000000%</div>
                                <div class="item-time-left" id="day-left"></div>
                            </div>
                           <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="day-progress-bar"></div>
                        </div>
                        <div class="item-details" id="day-details" role="region"></div>
                    </div>
                     <div class="list-item" id="week-item">
                        <div class="item-summary" role="button" tabindex="0" aria-expanded="false" aria-controls="week-details">
                           <div class="item-name">
                                <span>üìÖ</span>
                                <p>Ïù¥Î≤à Ï£º</p>
                            </div>
                            <div class="item-stats">
                                <div class="item-value" id="week-percentage">0.000000%</div>
                                <div class="item-time-left" id="week-left"></div>
                            </div>
                           <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="week-progress-bar"></div>
                        </div>
                        <div class="item-details" id="week-details" role="region"></div>
                    </div>
                    <div class="list-item" id="month-item">
                        <div class="item-summary" role="button" tabindex="0" aria-expanded="false" aria-controls="month-details">
                           <div class="item-name">
                                <span>üóìÔ∏è</span>
                                <p>Ïù¥Î≤à Îã¨</p>
                            </div>
                            <div class="item-stats">
                                <div class="item-value" id="month-percentage">0.000000%</div>
                                <div class="item-time-left" id="month-left"></div>
                            </div>
                           <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="month-progress-bar"></div>
                        </div>
                        <div class="item-details" id="month-details" role="region"></div>
                    </div>
                     <div class="list-item" id="year-item">
                        <div class="item-summary" role="button" tabindex="0" aria-expanded="false" aria-controls="year-details">
                           <div class="item-name">
                                <span>üéá</span>
                                <p>Ïò¨Ìï¥</p>
                            </div>
                            <div class="item-stats">
                                <div class="item-value" id="year-percentage">0.000000%</div>
                                <div class="item-time-left" id="year-left"></div>
                            </div>
                           <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="year-progress-bar"></div>
                        </div>
                        <div class="item-details" id="year-details" role="region"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script type="module">
        /**
         * @license
         * SPDX-License-Identifier: Apache-2.0
         */

        const blockCache = { day: false, week: false, month: false, year: false };

        function updateProgress() {
            const now = new Date();

            // --- Calculations ---
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            const dayTotalMilliseconds = endOfDay - startOfDay;
            const dayElapsedMilliseconds = now - startOfDay;
            const dayPercentage = (dayElapsedMilliseconds / dayTotalMilliseconds) * 100;
            const dayTimeLeft = dayTotalMilliseconds - dayElapsedMilliseconds;

            const dayOfWeek = now.getDay();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
            startOfWeek.setHours(0, 0, 0, 0);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 7);
            const weekTotalMilliseconds = endOfWeek - startOfWeek;
            const weekElapsedMilliseconds = now - startOfWeek;
            const weekPercentage = (weekElapsedMilliseconds / weekTotalMilliseconds) * 100;
            const weekTimeLeft = weekTotalMilliseconds - weekElapsedMilliseconds;

            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
            const monthTotalMilliseconds = endOfMonth - startOfMonth;
            const monthElapsedMilliseconds = now - startOfMonth;
            const monthPercentage = (monthElapsedMilliseconds / monthTotalMilliseconds) * 100;
            const monthTimeLeft = monthTotalMilliseconds - monthElapsedMilliseconds;

            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const endOfYear = new Date(now.getFullYear() + 1, 0, 1);
            const yearTotalMilliseconds = endOfYear - startOfYear;
            const yearElapsedMilliseconds = now - startOfYear;
            const yearPercentage = (yearElapsedMilliseconds / yearTotalMilliseconds) * 100;
            const yearTimeLeft = yearTotalMilliseconds - yearElapsedMilliseconds;

            // Block data calculations
            const blocksData = {
                day: {
                    total: 24,
                    filled: now.getHours() + 1,
                    grid: 'repeat(12, 1fr)'
                },
                week: {
                    total: 7,
                    filled: dayOfWeek === 0 ? 7 : dayOfWeek,
                    grid: 'repeat(7, 1fr)'
                },
                month: {
                    total: new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate(),
                    filled: now.getDate(),
                    grid: 'repeat(7, 1fr)'
                },
                year: {
                    total: 12,
                    filled: now.getMonth() + 1,
                    grid: 'repeat(6, 1fr)'
                }
            };
            
            // --- Update UI ---
            updateElement('day', dayPercentage, dayTimeLeft, blocksData.day);
            updateElement('week', weekPercentage, weekTimeLeft, blocksData.week);
            updateElement('month', monthPercentage, monthTimeLeft, blocksData.month);
            updateElement('year', yearPercentage, yearTimeLeft, blocksData.year);
        }

        function formatTimeLeft(ms, period) {
            if (ms < 0) return '';
            const totalSeconds = Math.floor(ms / 1000);
            const days = Math.floor(totalSeconds / (24 * 60 * 60));
            const hours = Math.floor((totalSeconds % (24 * 60 * 60)) / (60 * 60));
            const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            const pad = (num) => num.toString().padStart(2, '0');
            const timeString = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            return period === 'day' ? timeString : `${days}Ïùº ${timeString}`;
        }

        function updateElement(id, percentage, timeLeftMs, blockData) {
            const percentageEl = document.getElementById(`${id}-percentage`);
            const progressBarEl = document.getElementById(`${id}-progress-bar`);
            const timeLeftEl = document.getElementById(`${id}-left`);
            const detailsContainer = document.getElementById(`${id}-details`);

            if (percentageEl) percentageEl.textContent = `${percentage.toFixed(6)}%`;
            if (progressBarEl) progressBarEl.style.width = `${percentage}%`;
            if (timeLeftEl) timeLeftEl.textContent = `ÎÇ®Ïùå: ${formatTimeLeft(timeLeftMs, id)}`;
            
            if (detailsContainer) {
                if (!blockCache[id]) {
                    const fragment = document.createDocumentFragment();
                    for (let i = 0; i < blockData.total; i++) {
                        const block = document.createElement('div');
                        block.classList.add('block');
                        fragment.appendChild(block);
                    }
                    detailsContainer.style.gridTemplateColumns = blockData.grid;
                    detailsContainer.appendChild(fragment);
                    blockCache[id] = true;
                }

                const blocks = detailsContainer.children;
                for (let i = 0; i < blocks.length; i++) {
                    if (i < blockData.filled) {
                        blocks[i].classList.add('filled');
                    } else {
                        blocks[i].classList.remove('filled');
                    }
                }
            }
        }

        document.querySelectorAll('.item-summary').forEach(summary => {
            const item = summary.closest('.list-item');
            const details = item.querySelector('.item-details');
            
            const toggle = () => {
                const isExpanded = item.classList.toggle('expanded');
                summary.setAttribute('aria-expanded', isExpanded);
            };

            summary.addEventListener('click', toggle);
            summary.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggle();
                }
            });
        });

        updateProgress();
        setInterval(updateProgress, 100);
    </script>
</body>
</html>
